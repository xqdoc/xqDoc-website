<html xml:space="preserve"><head><title>xqDoc -- Code Sample</title></head><body xml:space="preserve"><pre>define function display:print-internal-variables-referenced($variable as element(), $local as xs:boolean) as element()*<br/>{<br/>  if (fn:exists($variable/xq:ref-variable[xq:uri = display:module-uri($variable)])) then<br/>    &lt;div class="methoddetail"&gt;<br/>     &lt;h6&gt;Internal Variables used by this Function&lt;/h6&gt;<br/>     &lt;table class="inexternal"&gt;<br/>       &lt;tr&gt;<br/>        &lt;th align="left"&gt;Module URI&lt;/th&gt;<br/>        &lt;th align="left"&gt;Variable Name&lt;/th&gt;<br/>       &lt;/tr&gt;<br/>      {<br/>       let $uris := for $x in fn:distinct-values($variable/xq:ref-variable/xq:uri)<br/>                    where $x = display:module-uri($variable)<br/>                    order by xs:string($x)<br/>                    return xs:string($x)<br/>       for $uri in $uris<br/>       let $names := for $y in $variable/xq:ref-variable[xq:uri=$uri]<br/>                     order by xs:string($y/xq:name)<br/>                     return xs:string($y/xq:name)<br/>       for $name at $i in $names<br/>       return<br/>         if ($i = 1) then<br/>		(&lt;tr&gt;&lt;td&gt;{"&amp;#160;"}&lt;/td&gt;&lt;td&gt;{"&amp;#160;"}&lt;/td&gt;&lt;/tr&gt;,<br/>            &lt;tr&gt;<br/>             &lt;td rowspan="{fn:count($names)}"&gt;{display:decode-uri($uri)}&lt;/td&gt;<br/>             {<br/>               if (fn:exists(fn:doc($uri)/xq:xqdoc/xq:variables/xq:variable[xq:uri = $name])) then<br/>                 &lt;td&gt;<br/>                     {<br/>                       display:build-link("get-module",<br/>                                          $local, <br/>                                          ($uri, fn:concat("$",$name)),<br/>                                          fn:concat("$",$name))<br/>                     }<br/>                 &lt;/td&gt;<br/>               else<br/>                 &lt;td&gt;{fn:concat("$",$name)}&lt;/td&gt;<br/>             }<br/>           &lt;/tr&gt;)<br/>         else<br/>           &lt;tr&gt;<br/>             {<br/>               if (fn:exists(fn:doc($uri)/xq:xqdoc/xq:variables/xq:variable[xq:uri = $name])) then<br/>                 &lt;td&gt;<br/>                     {<br/>                       display:build-link("get-module",<br/>                                          $local, <br/>                                          ($uri, fn:concat("$",$name)),<br/>                                          fn:concat("$",$name))<br/>                     }<br/>                 &lt;/td&gt;<br/>               else<br/>                 &lt;td&gt;{fn:concat("$",$name)}&lt;/td&gt;<br/>             }<br/>           &lt;/tr&gt;<br/>      }<br/>    &lt;/table&gt;<br/>   &lt;/div&gt;<br/><br/>  else<br/>    ()<br/>}<br/></pre></body></html>