<html xml:space="preserve"><head><title>xqDoc -- Code Sample</title></head><body xml:space="preserve"><pre>define function display:print-internal-functions-invoked($function as element(), $local as xs:boolean) as element()*<br/>{<br/>  if (fn:exists($function/xq:invoked[xq:uri = display:module-uri($function)])) then<br/>    &lt;div class="methoddetail"&gt;<br/>     &lt;h6&gt;Internal Functions used by this Function&lt;/h6&gt;<br/>     &lt;table class="inexternal"&gt;<br/>       &lt;tr&gt;<br/>        &lt;th align="left"&gt;Module URI&lt;/th&gt;<br/>        &lt;th align="left"&gt;Function Name&lt;/th&gt;<br/>       &lt;/tr&gt;<br/>      {<br/>       let $uris := for $x in fn:distinct-values($function/xq:invoked/xq:uri)<br/>                    where $x = display:module-uri($function)<br/>                    order by xs:string($x)<br/>                    return xs:string($x)<br/>       for $uri in $uris<br/>       let $names := for $y in $function/xq:invoked[xq:uri=$uri]<br/>                     order by xs:string($y/xq:name)<br/>                     return xs:string($y/xq:name)<br/>       for $name at $i in $names<br/>       return<br/>         if ($i = 1) then<br/>		(&lt;tr&gt;&lt;td&gt;{"&amp;#160;"}&lt;/td&gt;&lt;td&gt;{"&amp;#160;"}&lt;/td&gt;&lt;/tr&gt;,<br/>            &lt;tr&gt;<br/>             &lt;td rowspan="{fn:count($names)}"&gt;{display:decode-uri($uri)}&lt;/td&gt;<br/>             {<br/>               if (fn:exists(fn:doc($uri)/xq:xqdoc/xq:functions/xq:function[xq:name = $name])) then<br/>                 &lt;td&gt;<br/>                     {<br/>                       display:build-link("get-module",<br/>                                          $local, <br/>                                          ($uri, $name),<br/>                                          $name)<br/>                     }<br/>                 &lt;/td&gt;<br/>               else<br/>                 &lt;td&gt;{$name}&lt;/td&gt;<br/>             }<br/>           &lt;/tr&gt;)<br/>         else<br/>           &lt;tr&gt;<br/>             {<br/>               if (fn:exists(fn:doc($uri)/xq:xqdoc/xq:functions/xq:function[xq:name = $name])) then<br/>                 &lt;td&gt;<br/>                     {<br/>                       display:build-link("get-module",<br/>                                          $local, <br/>                                          ($uri, $name),<br/>                                          $name)<br/>                     }<br/>                 &lt;/td&gt;<br/>               else<br/>                 &lt;td&gt;{$name}&lt;/td&gt;<br/>             }<br/>           &lt;/tr&gt;<br/>      }<br/>    &lt;/table&gt;<br/>   &lt;/div&gt;<br/><br/>  else<br/>    ()<br/>}<br/></pre></body></html>