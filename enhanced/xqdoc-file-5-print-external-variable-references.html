<html xml:space="preserve"><head><title>xqDoc -- Code Sample</title></head><body xml:space="preserve"><pre>define function display:print-external-variable-references($variable as element(), $local as xs:boolean) as element()*<br/>{<br/>  if (fn:exists(fn:collection($display:XQDOC_COLLECTION)/xq:xqdoc/xq:functions/xq:function/xq:ref-variable[display:module-uri(.) != display:module-uri($variable) and xq:uri=display:module-uri($variable) and xq:name=xs:string($variable/xq:uri)])) then<br/>    &lt;div class="methoddetail"&gt;<br/>     &lt;h6&gt;External Functions that reference this Variable&lt;/h6&gt;<br/>     &lt;table class="inexternal"&gt;<br/>       &lt;tr&gt;<br/>        &lt;th align="left"&gt;Module URI&lt;/th&gt;<br/>        &lt;th align="left"&gt;Function Name&lt;/th&gt;<br/>       &lt;/tr&gt;<br/>       {<br/>        let $list := for $x in fn:collection($display:XQDOC_COLLECTION)/xq:xqdoc/xq:functions/xq:function/xq:ref-variable[xq:uri=display:module-uri($variable) and xq:name=xs:string($variable/xq:uri)]<br/>                     return $x<br/>        let $uris := fn:distinct-values(for $y in $list<br/>                                     where display:module-uri($y) != display:module-uri($variable)<br/>                                     order by display:module-uri($y)<br/>                                     return<br/>                                       display:module-uri($y))<br/>        for $uri in $uris<br/>        let $entries := for $entry in $list<br/>                        where display:module-uri($entry)=$uri<br/>                        order by $entry/../xq:name<br/>                        return $entry<br/>        for $entry at $i in $entries<br/>        return <br/>           if ($i = 1) then<br/>		(&lt;tr&gt;&lt;td&gt;{"&amp;#160;"}&lt;/td&gt;&lt;td&gt;{"&amp;#160;"}&lt;/td&gt;&lt;/tr&gt;,<br/>            &lt;tr&gt;<br/>             &lt;td rowspan="{fn:count($entries)}"&gt;{display:decode-uri($uri)}&lt;/td&gt;<br/>             {<br/>               if (fn:exists(fn:doc($uri)/xq:xqdoc/xq:functions/xq:function[xq:name = $entry/../xq:name])) then<br/>                 &lt;td&gt;<br/>                     {<br/>                       display:build-link("get-module",<br/>                                          $local, <br/>                                          ($uri, xs:string($entry/../xq:name)),<br/>                                          xs:string($entry/../xq:name))<br/>                     }<br/>                 &lt;/td&gt;<br/>               else<br/>                 &lt;td&gt;{xs:string($entry/../xq:name)}&lt;/td&gt;<br/>             }<br/>            &lt;/tr&gt;)<br/>           else<br/>            &lt;tr&gt;<br/>             {<br/>               if (fn:exists(fn:doc($uri)/xq:xqdoc/xq:functions/xq:function[xq:name = $entry/../xq:name])) then<br/>                 &lt;td&gt;<br/>                     {<br/>                       display:build-link("get-module",<br/>                                          $local, <br/>                                          ($uri, xs:string($entry/../xq:name)),<br/>                                          xs:string($entry/../xq:name))<br/>                     }<br/>                 &lt;/td&gt;<br/>               else<br/>                 &lt;td&gt;{xs:string($entry/../xq:name)}&lt;/td&gt;<br/>             }<br/>            &lt;/tr&gt;<br/>        }<br/>        &lt;/table&gt;<br/>       &lt;/div&gt;<br/>   else<br/>    ()<br/>}<br/></pre></body></html>